const timeTableJson = "[{\"arrivalTick\":30,\"connectionID\":\"S6\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":30,\"connectionID\":\"RB 47(24607)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":32,\"connectionID\":\"RE 99(24903)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":35,\"connectionID\":\"RB 16(24504)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":37,\"connectionID\":\"RB 49(15074)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":37,\"connectionID\":\"RB 48(24255)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":40,\"connectionID\":\"RB 49/41(15052)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":41,\"connectionID\":\"S6\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":42,\"connectionID\":\"RB 41(15003)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":42,\"connectionID\":\"RB 16(24562)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":42,\"connectionID\":\"RB 40(15103)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":44,\"connectionID\":\"RE 30(4152)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":48,\"connectionID\":\"RB 49(15151)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":54,\"connectionID\":\"RB 48(24257)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":58,\"connectionID\":\"RE 30(15863)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":63,\"connectionID\":\"RB 49(15075)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":64,\"connectionID\":\"RB 49(15075)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":65,\"connectionID\":\"RB 16(24506)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":66,\"connectionID\":\"RB 47(24663)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":67,\"connectionID\":\"RB 49(15164)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":71,\"connectionID\":\"RE 30(4153)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":71,\"connectionID\":\"RE 30(4173)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":71,\"connectionID\":\"S6\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":74,\"connectionID\":\"RB 40(15104)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":85,\"connectionID\":\"RB 15049\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":85,\"connectionID\":\"RB 47(24609)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":89,\"connectionID\":\"RE 30(4179)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":95,\"connectionID\":\"RB 16(24508)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":97,\"connectionID\":\"RB 49(15166)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":100,\"connectionID\":\"ICE 1573\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":101,\"connectionID\":\"RB 49(15168)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":102,\"connectionID\":\"RB 16(24564)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":104,\"connectionID\":\"RE 98(24408)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":104,\"connectionID\":\"RE 98(24438)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":104,\"connectionID\":\"RE 99(24908)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":104,\"connectionID\":\"RE 99(24958)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":116,\"connectionID\":\"RB 41(15005)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":116,\"connectionID\":\"RB 41(15005)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":116,\"connectionID\":\"RB 15149\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":116,\"connectionID\":\"RB 40(15105)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":118,\"connectionID\":\"RB 41(15006)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":118,\"connectionID\":\"RB 40(15106)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":125,\"connectionID\":\"RB 16(24510)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":127,\"connectionID\":\"RB 49(15170)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":129,\"connectionID\":\"RB 47(24611)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":132,\"connectionID\":\"RE 98(24403)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":132,\"connectionID\":\"RE 99(24905)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":132,\"connectionID\":\"RE 98(24405)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":132,\"connectionID\":\"RE 98(24425)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":135,\"connectionID\":\"ICE 1672\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":135,\"connectionID\":\"ICE 1672\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":155,\"connectionID\":\"RB 16(24512)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":157,\"connectionID\":\"RB 49(15076)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":157,\"connectionID\":\"RB 48(24261)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":162,\"connectionID\":\"RB 41(15007)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":162,\"connectionID\":\"RB 41(15007)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":162,\"connectionID\":\"RB 16(24566)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":162,\"connectionID\":\"RB 40(15107)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":164,\"connectionID\":\"RE 30(4154)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":184,\"connectionID\":\"RB 49(15077)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":185,\"connectionID\":\"RB 16(24514)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":186,\"connectionID\":\"RB 47(24665)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":189,\"connectionID\":\"RB 47(24613)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":191,\"connectionID\":\"RE 30(4155)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":191,\"connectionID\":\"S6\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":194,\"connectionID\":\"RB 41(15008)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":194,\"connectionID\":\"RB 40(15108)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":217,\"connectionID\":\"RB 49(15172)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":217,\"connectionID\":\"RB 48(24263)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":217,\"connectionID\":\"RB 48(61543)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":220,\"connectionID\":\"ICE 1575\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":221,\"connectionID\":\"RB 49(15174)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":221,\"connectionID\":\"S6\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":222,\"connectionID\":\"RB 16(24568)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":224,\"connectionID\":\"RE 98(24410)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":224,\"connectionID\":\"RE 99(24910)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":236,\"connectionID\":\"RB 41(15009)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":236,\"connectionID\":\"RB 41(15009)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":236,\"connectionID\":\"RB 40(15109)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":238,\"connectionID\":\"RB 41(15010)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":238,\"connectionID\":\"RB 40(15110)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":245,\"connectionID\":\"RB 16(24516)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":249,\"connectionID\":\"RB 47(24615)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":251,\"connectionID\":\"S6\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":252,\"connectionID\":\"RE 99(24907)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":252,\"connectionID\":\"RE 98(24407)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":255,\"connectionID\":\"IC 2370\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":255,\"connectionID\":\"IC 2370\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":277,\"connectionID\":\"RB 49(15078)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":277,\"connectionID\":\"RB 48(24265)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":281,\"connectionID\":\"S6\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":282,\"connectionID\":\"RB 41(15011)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":282,\"connectionID\":\"RB 16(24570)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":282,\"connectionID\":\"RB 40(15111)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":284,\"connectionID\":\"RE 30(4156)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":304,\"connectionID\":\"RB 49(15079)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":305,\"connectionID\":\"RB 16(24518)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":306,\"connectionID\":\"RB 47(24667)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":309,\"connectionID\":\"RB 47(24617)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":311,\"connectionID\":\"RE 30(4157)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":311,\"connectionID\":\"S6\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":314,\"connectionID\":\"RB 41(15012)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":314,\"connectionID\":\"RB 40(15112)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":334,\"connectionID\":\"RB 49(15081)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":337,\"connectionID\":\"RB 49(15176)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":337,\"connectionID\":\"RB 48(24267)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":337,\"connectionID\":\"RB 48(61545)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":341,\"connectionID\":\"ICE 1577\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":341,\"connectionID\":\"RB 49(15178)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":341,\"connectionID\":\"S6\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":342,\"connectionID\":\"RB 16(24572)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":344,\"connectionID\":\"RE 98(24412)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":344,\"connectionID\":\"RE 99(24912)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":356,\"connectionID\":\"RB 41(15013)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":356,\"connectionID\":\"RB 41(15013)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":356,\"connectionID\":\"RB 40(15113)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":358,\"connectionID\":\"RB 41(15014)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":358,\"connectionID\":\"RB 40(15114)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":365,\"connectionID\":\"RB 16(24520)\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":369,\"connectionID\":\"RB 47(24619)\",\"vehicle\":\"Train\",\"origin\":\"North\"},{\"arrivalTick\":371,\"connectionID\":\"S6\",\"vehicle\":\"Train\",\"origin\":\"South\"},{\"arrivalTick\":372,\"connectionID\":\"RE 99(24909)\",\"vehicle\":\"Train\",\"origin\":\"North\"}]";
const timaTable = JSON.parse(timeTableJson);

const coordNorth = [[50.3381128987894, 8.757856607044234], [50.3381128987894, 8.757856607044234], [50.334486880729486, 8.760021686030086], [50.33252712620832, 8.761234044504818]];
const coordSouth = [[50.32756006599437, 8.764976263046266], [50.32756006599437, 8.764976263046266], [50.329520184586016, 8.7631695267919], [50.33252712620832, 8.761234044504818]];

const getSmallestBirthTick = () => {
    let smallestBirthTick = Infinity;

    simulation.agents.forEach(agent => {
        if (agent.routeHasChanged.entry[0].value.vehicle === "PUBLICTRANSPORT" && agent.birthTick < smallestBirthTick) {
            smallestBirthTick = agent.birthTick;
        }
    })

    return smallestBirthTick;
}

const getGreatestBirthTick = () => {
    let greatestBirthTick = -Infinity;

    simulation.agents.forEach(agent => {
        if (agent.routeHasChanged.entry[0].value.vehicle === "PUBLICTRANSPORT" && agent.birthTick > greatestBirthTick) {
            greatestBirthTick = agent.birthTick;
        }
    })

    return greatestBirthTick;
}

function fakePublicTrans() {
    let publicTransStart = getSmallestBirthTick() - 1;
    let publicTransEnd = getGreatestBirthTick() - 1;

    /* while(publicTransStart <= publicTransEnd){
         let vel = [(publicTransStart*1000),500, 500];
         ((publicTransStart % 2) == 0) ? createTrainsMarker(coordSouth, vel) : createTrainsMarker(coordNorth, vel);
         publicTransStart++;
     } */
    for (let i = 0; i < timaTable.length; i++) {
        let coord;
        switch (timaTable[i].origin) {
            case "South":
                coord = coordSouth;
                break;
            case "North":
                coord = coordNorth;
                break;
        }
        let localTainVel = [500, 500];
        let timeWaiting = (timaTable[i].arrivalTick - (30 - getSmallestBirthTick() - 1)) * 1000;
        localTainVel.unshift(timeWaiting);
        if (timeWaiting > 0 && (timeWaiting / 1000) < lastTickInSimulation) createTrainsMarker(coord, localTainVel)
    }

}

function createTrainsMarker(coordinateArray, travelVel) {
    let myTrainMovingMarker = L.Marker.movingMarker(coordinateArray, travelVel);

    let trainIcon;
    let iconTrain = '../resources/images/transportMode/train.svg';

    trainIcon = L.icon({
        iconUrl: iconTrain, iconSize: [25, 25]
    });

    myTrainMovingMarker.options.icon = trainIcon;
    carList.push(myTrainMovingMarker);
}